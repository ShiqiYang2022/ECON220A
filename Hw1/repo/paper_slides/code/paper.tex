%% LyX 2.3.7 created this file.  For more info, see http://www.lyx.org/.
%% Do not edit unless you really know what you are doing.
\documentclass[12pt,hyperfootnotes=false]{article}
\usepackage[latin9]{inputenc}
\usepackage{geometry}
\geometry{verbose,tmargin=1in,bmargin=1in,lmargin=1in,rmargin=1in}
\usepackage{float}
\usepackage{amsmath}
\usepackage{amsthm}
\usepackage{amssymb}
\usepackage{graphicx}
\usepackage{setspace}
\usepackage{booktabs}

\usepackage[authoryear]{natbib}
\onehalfspacing

\makeatletter

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% LyX specific LaTeX commands.
%% Because html converters don't know tabularnewline
\providecommand{\tabularnewline}{\\}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% User specified LaTeX commands.
\usepackage{amsthm}
\usepackage{bm}
\usepackage{setspace}
\usepackage{sectsty}

\usepackage{datetime}
\usepackage{pdflscape}
\usepackage[english]{babel}
\usepackage[small]{caption}
\usepackage[bottom,hang,flushmargin]{footmisc}

\DeclareMathOperator{\sgn}{sgn}
\DeclareMathOperator{\Var}{Var}
\DeclareMathOperator{\Corr}{Corr}
\DeclareMathOperator{\Cov}{Cov}
\DeclareMathOperator{\E}{E}
\DeclareMathOperator{\logit}{logit}
\DeclareMathOperator{\I}{I}

\sectionfont{\noindent\normalfont\large\bf}
\subsectionfont{\noindent\normalfont\normalsize\bf}
\subsubsectionfont{\noindent\normalfont\it}

\pdfminorversion=4

\makeatother

\begin{document}
\title{\noindent \textbf{Econ 220A Homework 1}}
\author{\noindent Shiqi Yang,\textbf{ }\textit{UC Berkeley}\textbf{}\thanks{E-mail:\ shiqiy@berkeley.edu
}\textbf{}\\
}
\date{\today}
\maketitle

\begin{spacing}{1.4}

\section{Logit Demand Model with exogenous prices}

\subsection*{Question 1}

After normalizing calories, added sugar, and protein by package size, we construct a summary table of products available in city 1 during period 1, see below.

\input{Hw1/repo/analysis/output/q1_city1_period1_table}

From this table, we find that:

The two most expensive products are Chobani (price = 1.144) and Dannon (price = 1.141).

The two products with the largest market shares are Yoplait (market share = 16.6 \%) and Chobani (market share = 16.4 \%).


\subsection*{Question 2}

Let utility be
\[
u_{ijct} = -\alpha p_{jct} + \beta X_{j} + \xi_{jct} + \varepsilon_{ijct},
\]
with $\varepsilon_{ijct}\stackrel{iid}{\sim} \text{EV Type I}$ and the outside option
normalized to $u_{i0ct}=\varepsilon_{i0ct}$. Define the mean utility
\[
\delta_{jct}\equiv -\alpha p_{jct} + \beta X_{j} + \xi_{jct}.
\]

Under the multinomial logit, consumer $i$ chooses product $j$ iff $u_{ijct}\ge u_{ikct}$ for all $k$.
Aggregating over consumers yields the market share of product $j$ in market $(c,t)$:
\[
s_{jct} \;=\; 
\frac{\exp(\delta_{jct})}{1+\sum_{k=1}^{jct}\exp(\delta_{kct})},
\qquad
s_{0ct} \;=\;
\frac{1}{1+\sum_{k=1}^{jct}\exp(\delta_{kct})}.
\]

Taking the ratio $s_{jct}/s_{0ct}$ and logs gives the standard logit inversion:
\[
\log s_{jct} - \log s_{0ct}
\;=\;
\delta_{jct}
\;=\;
-\alpha p_{jct} + \beta X_{j} + \xi_{jct}.
\]

Hence, for each market $(c,t)$ the demand system consists of $jct$ equations,
each depending only on product $j$'s own price and characteristics:
\[
\boxed{\;
\log s_{jct} - \log s_{0ct}
\;=\;
-\alpha p_{jct} + \beta X_{j} + \xi_{jct},
\qquad j=1,\dots,jct.
\;}
\]

\subsection*{Question 3}

Under the assumption $\mathbb{E}[\xi_{jct}\mid p_{jct},X_j]=0$, we estimate the
inverted logit demand equation
\[
\log s_{jct}-\log s_{0ct}
= -\alpha\, p_{jct} + \beta_1\text{weight}_j + \beta_2\text{cal/g}_j
  + \beta_3\text{sugar/g}_j + \beta_4\text{protein/g}_j + \xi_{jct}.
\]
We compute $s_{0ct}$ as one minus the sum of inside shares in each market $(c,t)$. The results are presented in \ref{tab:q3_ols_ehw}.

\input{Hw1/repo/analysis/output/q3_ols_ehw}


\subsection*{Question 4}

We have

Own-price elasticity:
   \[
   \varepsilon_{jj}
   = \frac{\partial s_j}{\partial p_j}\cdot \frac{p_j}{s_j}
   = -\alpha p_j (1-s_j).
   \]

Cross-price elasticity:
   \[
   \varepsilon_{jm}
   = \frac{\partial s_j}{\partial p_m}\cdot \frac{p_m}{s_j}
   = \alpha p_m s_m.
   \]

Outside option (j=0):
   \[
   s_0 = 1 - \sum_{j=1}^J s_j, \qquad
   \varepsilon_{0m}
   = \frac{\partial s_0}{\partial p_m}\cdot \frac{p_m}{s_0}
   = \alpha p_m s_m \cdot \frac{s_0}{s_0} = \alpha p_m s_m.
   \]

Table \ref{tab:q4_elasticity_city1p1} reports the own price and cross-price elasticity in City 1, Period 1.

\input{Hw1/repo/analysis/output/q4_elasticities_city1p1}


\subsection*{Question 5}
\input{Hw1/repo/analysis/output/q5_diversion_city1p1}

\subsection*{Question 6}

For a single-product firm $j$ in market $(c,t)$, profit is
\[
\Pi_{jct} = M_{ct}\,(p_{jct} - c_{jct})\, s_{jct}(p_{jct}),
\]
where $s_{jct}$ follows the logit demand with
$\log s_{jct}-\log s_{0ct} = -\alpha p_{jct} + \beta'X_j + \xi_{jct}$.
The first-order condition is
\[
0 = \frac{\partial \Pi_{jct}}{\partial p_{jct}}
= s_{jct}(p) + (p_{jct}-c_{jct}) \frac{\partial s_{jct}(p)}{\partial p_{jct}}.
\]
Using the logit derivative
$\frac{\partial s_{jct}}{\partial p_{jct}} = -\alpha\, s_{jct}(1-s_{jct})$,
we obtain the markup:
\[
p_{jct} - c_{jct} = \frac{1}{\alpha(1-s_{jct})},
\qquad\text{so}\qquad
c_{jct} = p_{jct} - \frac{1}{\alpha(1-s_{jct})}.
\]


\subsection*{Question 7}

Using the single-product markup formula from Question 6, we have
\[
c_{jct} = p_{jct} - \frac{1}{\alpha(1-s_{jct})}
\]
Plugging in our estimates ($\hat\alpha\simeq 0.8643$) and the observed
prices and shares in city 1, period 1, we obtain:

\input{Hw1/repo/analysis/output/q7_mc_city1p1}

Answer: Not all costs are greater than zero; in fact, all recovered costs are
negative in this simple OLS logit setup. 

\subsection*{Question 8}

In the inverted-logit equation
\(
\log s_{jct}-\log s_{0ct}=-\alpha p_{jct}+\beta'X_j+\xi_{jct},
\)
prices are typically endogenous: positive demand shocks $\xi_{jct}$
(brand quality, promotions, shelf placement, etc.) induce firms to raise prices,
so $\mathrm{Cov}(p_{jct},\xi_{jct})>0$.
If we estimate by OLS imposing $\mathbb{E}[\xi\mid p,X]=0$,
the price coefficient $-\alpha$ is biased upward (less negative), hence $\hat\alpha$
is biased downward. Because the implied markup is
\(
p_j-c_j=\frac{1}{\alpha(1-s_j)},
\)
a downward-biased $\hat\alpha$ yields over-estimated markups and thus
under-estimated marginal.

\section{Logit Demand Model with three way fixed effects}

\subsection*{Question 9}
Consider the inverted-logit estimating equation
\[
\log s_{jct}-\log s_{0,ct}
= -\alpha\,p_{jct} \;+\; \tau_j \;+\; \tau_c \;+\; \tau_t \;+\; \varepsilon_{jct},
\]
where $\tau_j$ (product FE), $\tau_c$ (city FE), and $\tau_t$ (period FE) are unrestricted
additive terms. The product FE absorbs time- and market-invariant quality/brand appeal that
is typically positively correlated with prices (``high-quality--high-price''), the city FE absorbs
location-wide demand and cost shifters, and the period FE absorbs aggregate shocks (inflation,
seasonality, national advertising, etc.). Hence identification of $\alpha$ relies on \emph{within-product}
price variation across cities and/or periods, purging a large part of the omitted-variable bias present
in a pooled OLS without FE.

However, the unobserved, market-specific quality $\xi_{jct}$ (e.g., promotion, shelf placement)
may still be correlated with prices within a market, so three-way FE do not in general solve price
endogeneity. Instruments or cost shifters are still needed for full identification.

\subsection*{Question 10}

We estimate
\[
\log s_{jct}-\log s_{0,ct}
= -\alpha\,p_{jct} + \tau_j + \tau_c + \tau_t + \varepsilon_{jct}
\]
by OLS with Eicker--Huber--White (HC1) standard errors and product/city/period fixed effects.
Given the FE estimate $\hat\alpha$, market prices $p_{j11}$ and shares $s_{j11}$, own- and
cross-price elasticities in a multinomial logit are
\[
\varepsilon_{jj,11} = \frac{\partial s_{j11}}{\partial p_{j11}}\frac{p_{j11}}{s_{j11}}
= -\hat\alpha\,p_{j11}\,(1-s_{j11}),
\qquad
\varepsilon_{jk,11}
= \frac{\partial s_{j11}}{\partial p_{k11}}\frac{p_{k11}}{s_{j11}}
= \hat\alpha\,p_{k11}\,s_{k11} \quad (k\neq j).
\]
The diversion ratio from $j$ to $k$ is
\[
D_{j\to k,\,11}
= \frac{-\partial s_{k,11}/\partial p_{j,11}}{-\partial s_{0,11}/\partial p_{j,11}}
= \frac{s_{k,11}}{1-s_{j,11}}.
\]
Relative to the no-FE estimates, $|\hat\alpha|$ typically increases (less attenuation from
uncontrolled quality), so both own- and cross-price elasticities increase in magnitude, while
diversion ratios---which depend only on market shares in MNL---remain unchanged.

\subsection*{Question 11}

Under Bertrand competition, the first-order conditions imply
\[
s_{ct} = \Delta_{ct}\,(p_{ct}-c_{ct}),
\quad
\Delta_{ct} = \hat\alpha \,\Omega \odot \big(\mathrm{diag}(s_{ct})-s_{ct}s_{ct}^\top\big),
\]
where $\Omega$ is the ownership matrix and $\odot$ denotes the Hadamard product. Hence
\[
\boxed{ \; c_{ct} = p_{ct} - \Delta_{ct}^{-1}\,s_{ct}\; }.
\]
If each firm sells a single product ($\Omega=I$), this reduces to
\[
p_{jct}-c_{jct}=\frac{s_{jct}}{\hat\alpha\,(1-s_{jct})},
\qquad
c_{jct}=p_{jct}-\frac{s_{jct}}{\hat\alpha\,(1-s_{jct})}.
\]
Using $\hat\alpha$ from the FE regression and the observed prices and shares in city 1 and
period 1, we recover $c_{j11}$.

Adding FE often raises implied marginal costs (markups fall with larger $|\hat\alpha|$), but FE
do not remove within-market price endogeneity, measurement error in prices/shares, potential
multi-product ownership, or misspecification of demand (IIA). Any of these can still yield
implausible costs---including negative values (e.g., for Activia in this dataset). This is why FE
alone may not be sufficient; one typically adds valid cost instruments and, if needed, a random
coefficients demand system.



\end{spacing}
\end{document}
